/******************************************************************
*               Drag n Drop Modules Demo (for JSVM2)              *
* Name:         demo_lib_110.js                                   *
* Author:       bluepower (bluepspower@163.com)                   *
* Version:      v1.10                                             *
* Created Date: 2006-12-28                                        *
* Last Modify:  2006-01-05 by Niko                                *
* Copyright:    2006 by bluepower. All rights reserved.           *
* Attention:    Please do not remove these comments.              *
******************************************************************/
_JSVM_Namespace.runtimeEnvironment
	.JSVM.getClassloader().loadLib(new function()
{
this.manifest =
{
'name' : 'Drag n Drop Modules Demo',
'uri' : 'demo_lib_110.js',
'version' : '1.10',
'lastModified' : '2006-01-05',
'author' : 'Niko',
'remark' : 'demo-lib'
};
this.entity =
{
 'com.bluepower.ui.DDModules' : '(function(){_$package("com.bluepower.ui");var aj=[];var am=null;var ap=0;var ar=document.createElement("div");ar.id="module_proxy";ar.className="mProxy";var DDModules=com.bluepower.ui.DDModules=function(){this.av=false;this.isDraged=false;};DDModules.prototype.aD=function(a){if(this.av)return;this.av=true;aj=a;for(var aa=0;aa<aj.length;aa++){for(var ab=0;ab<aj[aa].childNodes.length-1;ab++){var ac=aj[aa].childNodes[ab];var ad=document.getElementById(ac.id+"_drag");if(!ad)continue;ad.module=ac;DDModules.init(ad);ad.onDragStart=function(af,ag){clearInterval(ap);var ai=this.module;DDModules.az(ai);ai.origNextSibling=ai.nextSibling;var oEl=DDModules.ah();oEl.style.left=DDModules.ao(ai,true)+"px";oEl.style.top=DDModules.ao(ai,false)+"px";oEl.style.height=ai.offsetHeight+"px";oEl.style.width=ai.offsetWidth+"px";oEl.style.display="block";oEl.style.opacity=0.5;oEl.style.filter="alpha(opacity=50)";oEl.innerHTML=ai.innerHTML;oEl.className=ai.className;this.dragged=false;};ad.onDrag=function(af,ag){DDModules.aF(this.module,af,ag);this.dragged=true;};ad.onDragEnd=function(af,ag){if(this.dragged){ap=DDModules.aC(this.module,150,0);DDModules.aw();}else{DDModules.aw();};if(this.module.nextSibling!=this.module.origNextSibling){DDModules.aw();DDModules.aT();}};}}};DDModules.aC=function(a,aa,ab){var oEl=this.ah();var ax=document.getElementById("module_proxy");ax.parentNode.insertBefore(a,ax);ax.parentNode.removeChild(ax);a.style.display="";var ac=parseInt(oEl.style.left);var ad=parseInt(oEl.style.top);var ae=(ac-this.ao(a,true))/ ab;var af=(ad-this.ao(a,false))/ ab;return setInterval(function(){if(ab<1){clearInterval(ap);DDModules.aw();return;};ab--;ac-=ae;ad-=af;oEl.style.left=parseInt(ac)+"px";oEl.style.top=parseInt(ad)+"px";},aa / ab);};DDModules.aF=function(a,aa,ab){var ac=null;var ad=100000000;a.style.display="none";for(var ae=0;ae<aj.length;ae++){for(var af=0;af<aj[ae].childNodes.length;af++){var ag=aj[ae].childNodes[af];if(ag==a)continue;var ai=Math.sqrt(Math.pow(aa-ag.pagePosLeft,2)+Math.pow(ab-ag.pagePosTop,2));if(isNaN(ai))continue;if(ai<ad){ad=ai;ac=ag;}}};if(ac!=null&&ar.nextSibling!=ac){ac.parentNode.insertBefore(ar,ac);this.aG(a);}};DDModules.aG=function(a){a.parentNode.style.display="none";a.parentNode.style.display=\'\';this.isDraged=true;};DDModules.ah=function(){if(!am){am=document.createElement("div");am.style.position="absolute";am.style.display="none";am.style.border="dotted #00f 1px";am.style.cursor="move";am.style.backgroundColor="#eee";document.body.appendChild(am);};return am;};DDModules.ao=function(a,aa){var ab=0;while(a!=null){ab+=a["offset"+(aa?"Left":"Top")];a=a.offsetParent;};return ab;};DDModules.aT=function(){if(this.isDraged){var oEl=document.getElementById("notice_area");if(oEl.style.display=="none")\noEl.style.display=\'\';}};DDModules.aw=function(){var oEl=this.ah();oEl.style.display="none";};DDModules.az=function(a){for(var aa=0;aa<aj.length;aa++){var ab=0;for(var ac=0;ac<aj[aa].childNodes.length;ac++){var ad=aj[aa].childNodes[ac];if(ad==a)\nab=ad.offsetHeight;ad.pagePosLeft=this.ao(ad,true);ad.pagePosTop=this.ao(ad,false)-ab;}}};DDModules.obj=null;DDModules.init=function(a){var oEl=DDModules.ah();a.onmousedown=DDModules.start;if(isNaN(parseInt(oEl.style.left)))\noEl.style.left="0px";if(isNaN(parseInt(oEl.style.top)))\noEl.style.top="0px";a.onDragStart=function(){};a.onDragEnd=function(){};a.onDrag=function(){};};DDModules.start=function(a){var oEl=DDModules.ah();var aa=DDModules.obj=this;a=DDModules.fixE(a);var ab=parseInt(oEl.style.top);var ac=parseInt(oEl.style.left);aa.onDragStart(ac,ab,a.clientX,a.clientY);aa.lastMouseX=a.clientX;aa.lastMouseY=a.clientY;document.onmousemove=DDModules.drag;document.onmouseup=DDModules.end;return false;};DDModules.drag=function(a){var oEl=DDModules.ah();a=DDModules.fixE(a);var aa=DDModules.obj;var ab=a.clientY;var ac=a.clientX;var ad=parseInt(oEl.style.top);var ae=parseInt(oEl.style.left);var af,ag;af=ae+ac-aa.lastMouseX;ag=ad+ab-aa.lastMouseY;oEl.style.left=af+"px";oEl.style.top=ag+"px";aa.lastMouseX=ac;aa.lastMouseY=ab;aa.onDrag(af,ag,a.clientX,a.clientY);return false;};DDModules.end=function(){var oEl=DDModules.ah();document.onmousemove=null;document.onmouseup=null;DDModules.obj.onDragEnd(parseInt(oEl.style.left),parseInt(oEl.style.top));DDModules.obj=null;};DDModules.fixE=function(a){if(typeof a=="undefined")\na=window.event;if(typeof a.layerX=="undefined")\na.layerX=a.offsetX;if(typeof a.layerY=="undefined")\na.layerY=a.offsetY;return a;};})();' ,
 'com.bluepower.ui.DemoPage' : '(function(){_$package("com.bluepower.ui");_$import("com.bluepower.ui.DDModules");var DemoPage=com.bluepower.ui.DemoPage=function(){this.ddm=null;};DemoPage.prototype={init:function(sQueue){this.ddm=new com.bluepower.ui.DDModules();this.createLayout(sQueue);this.setCheckBox(sQueue);this.showInfo(sQueue);},getEl:function(sId){return document.getElementById?document.getElementById(sId):null;},hideEl:function(sId){var oEl=this.getEl(sId);if(oEl)oEl.style.display="none";},swapDisplay:function(sId){var oEl=this.getEl(sId);if(oEl){oEl.style.display=oEl.style.display==\'\'?"none":\'\';}},setCheckBox:function(sQueue){var oEl=null;var a=this.getModules(sQueue.split(\'|\'));var arr=this.getModules(sDefault.split(\'|\'));for(var i=0;i<a.length;i++){oEl=this.getEl("module_"+a[i]);if(oEl)oEl.checked=true;};for(var j=0;j<arr.length;j++){oEl=this.getEl("module_"+arr[j]);if(oEl)oEl.disabled=true;}},setModule:function(){var sQueue=this.getCookie("modules");var oSetModule=this.getEl("set_module_area");if(oSetModule){var arr=oSetModule.getElementsByTagName("input");for(var j=0;j<arr.length;j++){var oEl=arr[j];var sValue=oEl.value;if(oEl.type=="checkbox"){if(oEl.checked&&sQueue.indexOf(sValue)==-1)\nsQueue+=\',\'+sValue;if(!oEl.checked){var oModule=this.getEl(sValue);if(oModule)oModule.parentNode.removeChild(oModule);var iPos=sQueue.indexOf(sValue);if(iPos>-1){var c=sQueue.charAt(iPos-1);if(c==\',\')\nsQueue=sQueue.replace(\',\'+sValue,\'\');if(c==\'|\')\nsQueue=sQueue.replace(\'|\'+sValue,\'|empty\');if(c==\'\'){if(sQueue.split(\'|\')[0].split(\',\').length>1)\nsQueue=sQueue.replace(sValue+\',\',\'\');else\nsQueue=sQueue.replace(sValue,\'empty\');}}}}};this.setCookie("modules",sQueue);this.hideEl("set_module_area");this.showInfo(sQueue);this.createLayout(sQueue);}},createLayout:function(sQueue){;var oMain=this.getEl("main_area");if(!oMain){oMain=document.createElement("div");oMain.id="main_area";oMain.className="cB mArea";document.body.appendChild(oMain);};var aCols=sQueue.split(\'|\');var a=[];a[0]=\'<table id="main_container" class="wFull"><tr valign="top">\';for(var i=1;i<=aCols.length;i++){var sTmpId="col"+i;var sTmpCName=i%2==0?"cell2":"cell1";a[a.length]=\'<td id="\' + sTmpId + \'" class="\' + sTmpCName + \'"></td>\';};a[a.length]=\'</tr></table>\';oMain.innerHTML=a.join(\'\');this.adjustView();this.createModule(aCols);},createModule:function(arr){var aCol=[];for(var i=1;i<=arr.length;i++){aCol[aCol.length]=this.getEl("col"+i);var aModules=arr[i-1].split(\',\');var sTmpId,a=[];for(var j=1;j<=aModules.length;j++){sTmpId=aModules[j-1];if(sTmpId=="empty")continue;a[a.length]=\'<div height="300" id="\' + sTmpId + \'" class="cB p2"><table height="200" class="cB title\' + i + \' wFull"><tr>\';a[a.length]=\'<td id="\' + sTmpId + \'_drag" class="cMove">::: \'+saTitle[sTmpId].split("|")[1]+\' :::</td>\';a[a.length]=\'<td class="w1"><a href=\\\'javascript:dp.swapDisplay("\' + sTmpId + \'_content")\\\'><img src="res/img/ico_min_max.gif" alt="缩放" /></a></td>\';a[a.length]=\'<td class="w1"><a href=\\\'javascript:dp.hideEl("\' + sTmpId + \'")\\\'><img src="res/img/ico_close.gif" alt="关闭" /></a></td></tr></table>\';a[a.length]=\'<div id="\' + sTmpId + \'_content" class="cB mContent">\';a[a.length]=\'<img src="res/img/ico_loading.gif" alt="loading" align="absmiddle" /> 正在载入 \'+sTmpId+\' 模块内容...</div></div>\';};a[a.length]=\'<p class="cB mSpace"></p>\';this.getEl("col"+i).innerHTML=a.join(\'\');};this.ddm.av=false;this.ddm.aD(aCol);this.fetchContent(arr);},createEl:function(iIndex,oRow){var sTmpCName=iIndex%2==0?"cell2":"cell1";var oEl=document.createElement("td");oEl.id="col"+iIndex;oEl.className=sTmpCName;oRow.appendChild(oEl);oEl.innerHTML=\'<p class="cB mSpace"></p>\';this.adjustView();},deleteEl:function(sColId,sId,oRow,iDelCol){var oColEl=this.getEl(sColId);if(oColEl){var a=oColEl.childNodes;for(var i=0;i<a.length;i++){if(a[i].tagName.toLowerCase()==\'p\')\noColEl.removeChild(a[i]);};var arr=this.getEl(sId).childNodes;for(var j=0;j<arr.length;j++){var oCloneNode=arr[j].cloneNode(true);oColEl.appendChild(oCloneNode);};oRow.deleteCell(iDelCol);this.adjustView();}},adjustView:function(){var oEl=this.getEl("main_container");if(oEl){var oRow=oEl.rows[0];var iLen=oRow.cells.length;var iW=parseInt(100/iLen);for(var i=0;i<iLen;i++){oRow.cells[i].style.width=iW+"px";}}},saveSetting:function(){var aModules=[],arr=[];var oEl=this.getEl("main_container");if(oEl){var iLen=oEl.rows[0].cells.length;for(var i=1;i<=iLen;i++){arr[arr.length]=this.getEl("col"+i);};for(var j=0;j<arr.length;j++){var a=arr[j].childNodes;if(a.length>1){for(var k=0;k<a.length-1;k++){var oNode=a[k];if(oNode.id){var sTmp=k==a.length-2?\'|\':\',\';aModules[aModules.length]=oNode.id+sTmp;}}}else{aModules[aModules.length]="empty|";}};var sStr=aModules.join(\'\');var sQueue=sStr.substring(0,sStr.length-1);this.setCookie("modules",sQueue);this.hideEl("notice_area");this.showInfo(sQueue);}},getModules:function(arr){var a=[];for(var i=0;i<arr.length;i++){var aModules=arr[i].split(\',\');for(var j=0;j<aModules.length;j++){a[a.length]=aModules[j];}};return a;},fetchContent:function(arr){var _this=this;var a=this.getModules(arr);var oRes=this.getEl("iframe_data");if(!oRes){oRes=document.createElement("iframe");oRes.className="resData";oRes.setAttribute("id","iframe_data");oRes.setAttribute("name","iframe_data");document.body.appendChild(oRes);}oRes.src=WEB_PATH+"/staff/portlet/DemoData.jsp";var fnDelayData=function(){var oDataFrame=window.frames["iframe_data"];var aTags=oDataFrame.document.getElementsByTagName("xmp");for(var i=0;i<a.length;i++){for(var j=0;j<aTags.length;j++){if(aTags[j].id==a[i])\n_this.getEl(a[i]+"_content").innerHTML=aTags[j].innerHTML;}}};window.setTimeout(fnDelayData,2000);},setTheme:function(sStr){var oEl=this.getEl("demo_theme");if(oEl)oEl.href="css/demo_"+sStr+".css";},setCookie:function(name,value){setStaffPortlet(value);/*原自带代码var today=new Date();var expires=new Date();expires.setTime(today.getTime()+1000*60*60*24*365);document.cookie=name+"="+escape(value)+"; expires="+expires.toGMTString();*/},getCookie:function(name){;return sDefault;/*原有代码var search=name+"=";if(document.cookie.length>0){var offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;var end=document.cookie.indexOf(";",offset);if(end==-1)\nend=document.cookie.length;return unescape(document.cookie.substring(offset,end));}else return(\'\');}else return(\'\');*/},showInfo:function(sQueue){var oNavBar=this.getEl("nav_area");var oInfo=this.getEl("show_info");if(!oInfo){oInfo=document.createElement("span");oInfo.id="show_info";oInfo.className="fL f1";oNavBar.appendChild(oInfo);};oInfo.innerHTML="";},setColumn:function(iIndex){var oEl=this.getEl("main_container");if(oEl){var oRow=oEl.rows[0];var iLen=oRow.cells.length;switch(iIndex){case 4:if(iLen==4)return;if(iLen==3)\nthis.createEl(4,oRow);if(iLen==2){this.createEl(3,oRow);this.createEl(4,oRow);};if(iLen==1){this.createEl(2,oRow);this.createEl(3,oRow);this.createEl(4,oRow);};this.ddm.av=false;this.ddm.aD([this.getEl("col1"),this.getEl("col2"),this.getEl("col3"),this.getEl("col4")]);this.saveSetting();break;case 2:if(iLen==2)return;if(iLen==4){this.deleteEl("col2","col4",oRow,3);this.deleteEl("col2","col3",oRow,2);};if(iLen==3)\nthis.deleteEl("col2","col3",oRow,2);if(iLen==1)\nthis.createEl(2,oRow);this.ddm.av=false;this.ddm.aD([this.getEl("col1"),this.getEl("col2")]);this.saveSetting();break;case 1:if(iLen==1)return;if(iLen==4){this.deleteEl("col1","col4",oRow,3);this.deleteEl("col1","col3",oRow,2);this.deleteEl("col1","col2",oRow,1);};if(iLen==3){this.deleteEl("col1","col3",oRow,2);this.deleteEl("col1","col2",oRow,1);};if(iLen==2)\nthis.deleteEl("col1","col2",oRow,1);this.ddm.av=false;this.ddm.aD([this.getEl("col1")]);this.saveSetting();break;default:if(iLen==3)return;if(iLen==4)\nthis.deleteEl("col3","col4",oRow,3);if(iLen==2)\nthis.createEl(3,oRow);if(iLen==1){this.createEl(2,oRow);this.createEl(3,oRow);};this.ddm.av=false;this.ddm.aD([this.getEl("col1"),this.getEl("col2"),this.getEl("col3")]);this.saveSetting();break;}}}}})();' ,
 'null' : null
};
});

